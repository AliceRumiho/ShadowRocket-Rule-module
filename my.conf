[General]
# Shadowrocket 快速使用方法：
# 1、首页 > 添加节点。
# 2、设置 > 延迟测试方法，选择 CONNECT。
# 3、首页 > 连通性测试，选择可用节点连接。
# 首次启动会提示【安装 VPN 配置文件】，请点击【好】和【允许】才能正常使用。

# 【配置锁定：[General] 区段中所有位于 'skip-proxy' 之前的配置项将被锁定，不会被更新！】

# 旁路系统。 (已锁定)
bypass-system = true

# DNS 覆写。 (已锁定)
dns-server = quic://dns.adguard.com

# 备用 DNS。 (已锁定)
fallback-dns-server = tls://dns.alidns.com

# 启用 IPv6 支持。 (已锁定)
ipv6 = false

# DNS 劫持。 (已锁定)
hijack-dns = 8.8.8.8:53,8.8.4.4:53

# TUN 旁路路由。 (已锁定)
# *** 优化：移除私有 IP 段，确保本地 IP 流量进入 TUN 隧道，接受规则处理 ***
tun-excluded-routes = 100.64.0.0/10, 127.0.0.0/8, 169.254.0.0/16, 192.0.0.0/24, 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, 224.0.0.0/4, 255.255.255.255/32, 239.255.255.250/32

# 跳过代理。 (LOCK MARKER: 此行之前的所有 [General] 配置将被锁定)
skip-proxy = 192.168.0.0/16,10.0.0.0/8,172.16.0.0/12,localhost,*.local,captive.apple.com,*.ccb.com,*.abchina.com.cn,*.psbc.com,www.baidu.com

# 当 UDP 流量匹配到规则里不支持 UDP 转发的节点策略时重新选择回退行为。
udp-policy-not-supported-behaviour = REJECT

# 其他优化项 (这些位于锁定标记之后，可随 URL 更新)
private-ip-answer = false
dns-direct-fallback-proxy = true
ipv6-only-if-no-ipv4-dns = false
block-quic = all-proxy

# *** 启用模块化更新：规则将从 GitHub Gist 自动下载并更新 ***
# 请确保此链接是最新的、包含 DNS 显式分流规则的版本
module-url = https://gist.githubusercontent.com/AliceRumiho/521a980eeb8ce8996217b0291c0f77bd/raw/rule%20module.conf

# Google搜索引擎防跳转的重写。
^https?://(www.)?g.cn https://www.google.com 302
^https?://(www.)?google.cn https://www.google.com 302

[Proxy]
# === 代理节点 (Proxy Nodes) ===
# *** 请在此处手动添加您的所有节点，或通过订阅链接导入节点 ***

[Proxy Group]
# === 代理分组 (Proxy Groups) - 采用内置 PROXY 引用，无需定义 PROXY 组 ===
# PROXY 策略是内置引用，指向 App 首页选择的当前节点。

# 所有服务策略组引用 PROXY (当前节点) 和 DIRECT (直连)
AI = select,PROXY,DIRECT,policy-select-name=PROXY
YouTube = select,PROXY,DIRECT,policy-select-name=PROXY
Netflix = select,PROXY,DIRECT,policy-select-name=PROXY
Disney+ = select,PROXY,DIRECT,policy-select-name=PROXY
Max = select,PROXY,DIRECT,policy-select-name=PROXY
TikTok = select,PROXY,DIRECT,policy-select-name=PROXY
Spotify = select,DIRECT,PROXY,policy-select-name=PROXY
Telegram = select,PROXY,DIRECT,policy-select-name=PROXY
Twitter = select,PROXY,DIRECT,policy-select-name=PROXY
Facebook = select,PROXY,DIRECT,policy-select-name=PROXY
PayPal = select,DIRECT,PROXY,policy-select-name=PAYPAL
Amazon = select,DIRECT,PROXY,policy-select-name=PROXY
苹果服务 = select,DIRECT,PROXY,policy-select-name=DIRECT
谷歌服务 = select,PROXY,DIRECT,policy-select-name=PROXY
微软服务 = select,DIRECT,PROXY,policy-select-name=DIRECT
哔哩哔哩 = select,DIRECT,PROXY,policy-select-name=DIRECT
游戏平台 = select,DIRECT,PROXY,policy-select-name=DIRECT

[Rule]
# === 规则区段留空 ===
# 所有的规则列表现在都由外部模块 (module-url) 自动加载。

[Host]
*.apple.com = server:system
*.icloud.com = server:system
localhost = 127.0.0.1

[MITM]
hostname = *.google.cn